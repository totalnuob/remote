<style>
    .ng2-dropdown-menu {
    z-index: 1051 !important;
}

</style>
<div class="container">
    <div class="row withpadding" style="position: relative; min-height: 80px;">
        <div [ngBusy]="busy">
            <div class="row top-buffer" >
                <div class="col-md-12">
                    <ol class="breadcrumb">
                        <li>
                            <span *ngIf="breadcrumbParams != null && !fromICMeeting"><a [routerLink]="['/corpMeetings', {params: this.breadcrumbParams, activeTab: 'IC_TOPICS'}]">IC Topics</a></span>
                            <span *ngIf="breadcrumbParams == null && !fromICMeeting"><a [routerLink]="['/corpMeetings', {params: {}, activeTab: 'IC_TOPICS'}]">IC Topics</a></span>
                            <span *ngIf="fromICMeeting"><a [routerLink]="[backPath]">IC</a></span>
                        </li>
                        <li class="active">IC Topic</li>
                    </ol>
                </div>
            </div>
            <div class="row top-buffer" >
                <div class="alert alert-danger" *ngIf="errorMessage != null"><span>{{errorMessage}}</span>
                </div>
                <div class="alert alert-info" *ngIf="successMessage != null"><span>{{successMessage}}</span>
                </div>
            </div>
            <div>
                <form #corpMeetingForm="ngForm" class="well span">
                    <div class="row" *ngIf="icMeetingTopic.status != null">
                        <label [ngClass]="getClassByStatus()">{{icMeetingTopic.status}}
                            <span *ngIf="icMeetingTopic.closed" class="glyphicon glyphicon-lock"></span>
                        </label>
                    </div>
                    <fieldset [disabled]="!canEdit()">
                        <div class="row top-buffer">
                            <div class="col-md-3 form-group form-horizontal">
                                <label class="control-label col-md-2" for="icList">IC </label>
                                <div class="col-md-10">
                                    <select class="form-control" id="icList" name="icList" [(ngModel)]="icMeetingTopic.icMeeting.id" (ngModelChange)="icListChanged()">
                                        <option [value]="0">---</option>
                                        <option *ngFor = "let ic of icList" [value]="ic?.id">â„–{{ic?.number}} ( {{ic?.date}} )</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-9 form-group form-horizontal">
                                <label class="control-label col-md-1" for="questionName">Name:</label>
                                <div class="col-md-11">
                                    <textarea fz-elastic type="text" id="questionName" class="form-control"
                                              placeholder="Enter question name (will be added to IC Protocol)..." name="questionName" [(ngModel)]="icMeetingTopic.name"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="row top-buffer">
                            <div class="col-md-12">
                                <div class="row top-buffer">
                                    <div class="form-group form-horizontal">
                                        <label class="control-label col-md-2" for="description">Description:</label>
                                        <div class="col-md-10">
                                            <textarea fz-elastic type="text" id="description" class="form-control"
                                                      placeholder="Enter description (will not be added to IC Protocol)..."
                                                      maxlength="500" name="description" [(ngModel)]="icMeetingTopic.description"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>

                        <div class="row top-buffer">
                            <div class="col-md-12">
                                <div class="col-md-9">
                                    <div class="row top-buffer">
                                        <div class="form-group form-horizontal">
                                            <label class="control-label col-md-4">Explanatory Note:</label>
                                            <div class="col-md-8">
                                                <div class="row" *ngIf="canEdit()">
                                                    <label class="btn btn-primary btn-xs col-md-3" [ngClass]="icMeetingTopic.explanatoryNote != null && icMeetingTopic.explanatoryNote.id > 0 ? 'disabled' : ''"  for="explanatoryNoteFile">
                                                        <input type="file" id="explanatoryNoteFile" (change)="onFileChangeExplanatoryNote($event)" [disabled]="icMeetingTopic.explanatoryNote != null && icMeetingTopic.explanatoryNote.id > 0" name="explanatoryNoteFile" style="display:none;"/>Upload</label>
                                                    <div class="col-md-9">
                                                        <div class="row" *ngFor="let aFile of uploadExplanatoryNoteFile"style="display: table;">
                                                            <span class="label label-info" >{{aFile.name | slice:0:55}} {{aFile?.name?.length > 55 ? '...' : ''}}
                                                            </span> &nbsp;
                                                            <button class="btn btn-xs" (click)="deleteUnsavedExplanatoryNote(aFile)" *ngIf="canEdit()">
                                                                <i class="glyphicon glyphicon-trash"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row" *ngIf="icMeetingTopic?.explanatoryNote != null">
<!--                                                    <div class="col-md-2">&nbsp;</div>-->
                                                    <div class="col-md-12">
                                                        <div class="col-md-7">
                                                            <div class="pull-right">
                                                            <file-attachment-downloader fileId="{{icMeetingTopic.explanatoryNote?.id}}"
                                                                                        fileName="{{(icMeetingTopic.explanatoryNote?.fileName |  slice:0:55) +
                                                                                        (icMeetingTopic.explanatoryNote?.fileName?.length > 55 ? '...' : '')}}"
                                                                                        fileType="IC_EXPNOTE" mimeType="{{icMeetingTopic.explanatoryNote?.mimeType}}"
                                                                                        showIcon="true">
                                                            </file-attachment-downloader>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-1">
                                                            <button class="btn btn-xs"  (click)="deleteExplanatoryNote()" *ngIf="icMeetingTopic.explanatoryNote.id > 0 && canEdit()">
                                                                <i class="glyphicon glyphicon-trash"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="col-md-3">
                                    <label class="control-label col-md-2" for="speakerList">Speaker (your department):</label>
                                    <select class="form-control" id="speakerList" name="speakerList" [(ngModel)]="icMeetingTopic.speaker.id"  [ngModelOptions]="{standalone: true}">
                                        <option *ngFor = "let speaker of departmentEmployeeList" [value]="speaker.id">{{speaker.firstName}} {{speaker.lastName}}</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row top-buffer">
                            <div class="col-md-12">
                                <div class="col-md-9">&nbsp;
                                </div>
                                <div class="col-md-3">
                                    <label class="control-label col-md-2" for="executorList">Executor (your department):</label>
                                    <select class="form-control" id="executorList" name="executorList" [(ngModel)]="icMeetingTopic.executor.id">
                                        <option *ngFor = "let executor of departmentEmployeeList" [value]="executor.id">{{executor.firstName}} {{executor.lastName}}</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <br>
<!--                        <hr style="border-top: 1px solid #B5AEAE">-->

                        <div class="row top-buffer">
                            <div class="col-md-12">
                                <div class="row withpadding">
                                    <span>Decision</span>
                                    <textarea fz-elastic spellcheck="false"  type="text" placeholder="..." class="form-control"
                                          id="decision" name="decision" [(ngModel)]="icMeetingTopic.decision"></textarea>
                                </div>
                                <div class="row">
                                    &nbsp;
                                </div>
                            </div>
                        </div>
                        <br/>

                        <div class="modal fade" id="addApproveListModal" role="dialog" tabindex="-1">
                            <div class="modal-dialog" style=" min-height: 800px; max-height:85%;  margin-top: 50px; margin-bottom:50px; width:50%;">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <!--<h3 class="modal-title" >HEADER</h3>-->
                                    </div>
                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-6" *ngIf="availableApproveList?.length > 0">
                                                <h4>Approve List: </h4>
                                                <ng-select #approveListSelect [initData]="editableApproveList"
                                                           [multiple]="true"
                                                           [items]="availableApproveList"
                                                           (data)="refreshApproveList($event)"
                                                           (selected)="selectedApproveList($event)"
                                                           (removed)="removedApproveList($event)"
                                                           placeholder="No employee selected"></ng-select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default pull-right" (click)="updateApproveListModal()" data-dismiss="modal">OK</button>
                                    </div>
                                </div>
                            </div>
                        </div>

<!--                        <hr style="border-top: 1px solid #B5AEAE">-->
                        <div class="row top-buffer">
                            <div class="jumbotron col-md-12" style="padding-top: 5px; padding-bottom: 5px;">
                                <div class="row">
                                    <span>MATERIALS</span>
                                    <label class="btn btn-primary btn-xs" for="attachmentFile">
                                        &nbsp;
                                        <input type="file" id="attachmentFile" (change)="onFileChangeMaterials($event)" name="file" multiple style="display:none;"/>Upload
                                    </label>
                                </div>

                                <div class="row">
                                    <table style="width: 100%; table-layout: fixed;" >
                                        <tr *ngFor="let newFile of uploadMaterialsFiles; let j = index" [attr.data-index]="j">
                                            <td>
                                                <span class="label label-info ">
                                                    {{newFile.file.name | slice:0:55 }} &nbsp;
                                                    {{newFile?.file?.name?.length > 55 ? '...' : ''}}
                                                </span> &nbsp;
                                                <button class="btn btn-xs"  (click)="deleteUnsavedAttachment(newFile)" *ngIf="canEdit()">
                                                    <i class="glyphicon glyphicon-trash"></i>
                                                </button>
                                            </td>
                                            <td>
                                                <input class="form-control" [attr.id]="'material_file_' + j" type="text" placeholder="name for protocol..." style="width: 100%"
                                                       [(ngModel)]="newFile.name" [ngModelOptions]="{standalone: true}"/>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <br/>
                                <div class="row">
                                    <table class="table" >
                                        <tr *ngFor="let attachment of icMeetingTopic?.materials; let j = index" [attr.data-index]="j">
                                            <td width="10%">
                                                <a *ngIf="j > 0" class="btn btn-primary btn-xs glyphicon glyphicon-arrow-up" (click)="moveTopicMaterialUp(j)"></a>
                                                <a *ngIf="j < icMeetingTopic?.materials.length - 1" class="btn btn-primary btn-xs glyphicon glyphicon-arrow-down" (click)="moveTopicMaterialDown(j)"></a>
                                            </td>
                                            <td width="35%">
                                                <file-attachment-downloader fileId="{{attachment.file.id}}"
                                                                            displayFileName="{{(j + 1) + '. ' + attachment?.file?.fileName | slice:0:60}} ..."
                                                                            fileName="{{attachment?.file?.fileName}}" mimeType="{{attachment?.file?.mimeType}}"
                                                                            fileType="IC_MATRL" showIcon="true">
                                                </file-attachment-downloader>
                                            </td>
                                            <td width="35%">
                                                <input class="form-control" type="text" style="width: 100%" [(ngModel)]="attachment.name" [ngModelOptions]="{standalone: true}"/>
                                            </td>
                                            <td width="10%">&nbsp;
                                                <small>
                                                    <span style="cursor: pointer" (click)="deleteAttachment(attachment.file.id, false)" *ngIf="canEdit()">
                                                        <i class="glyphicon glyphicon-trash"></i>
                                                    </span>
                                                </small>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="row top-buffer">
                            <div class="row withpadding">
                                <div class="col-md-12">
                                    <div class="col-md-6">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <span>Approve list</span>&nbsp;
                                                <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#addApproveListModal"
                                                        [disabled]="!canEdit()" (click)="addApproveListEmployee()">

                                                    <span class="glyphicon glyphicon-pencil"></span>
                                                </button>
                                            </div>
                                            <div class="col-md-8">
                                                <div class="row" *ngFor="let item of icMeetingTopic?.approveList">
                                                    <span *ngIf="item.approved" class="glyphicon glyphicon-ok-circle" style="color: green"></span>
                                                    <span *ngIf="!item.approved"class="glyphicon glyphicon-hourglass" style="color: grey"></span>
                                                    {{item.employee.fullName != null ? item.employee.fullName : (item.employee.firstName + ' ' + item.employee.lastName)}}
                                                    <span *ngIf="autoAddedApproveListMember(item)">
                                                        <small><i>(auto-added, can be removed)</i></small>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <br/>
                                        <div class="row" *ngIf="icMeetingTopic?.approveList?.length > 0">
                                            <div class="col-md-4">
                                                <span>Export Approve List </span>
                                                <img src="../../../../public/img/ms_word.png" height="25" width="25" (click)="exportApproveList()"/>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="col-md-6">
                                        <tag-input name="tags"
                                                   [ngModel]="icMeetingTopic.tags"
                                                   (onRemove)="onTagRemoved($event)"
                                                   (onAdd)="onTagAdded($event)"
                                                   [placeholder]="tagOptions.placeholder"
                                                   [secondaryPlaceholder]="tagOptions.secondaryPlaceholder"
                                                   [maxItems]="tagOptions.maxItems"
                                                   [separatorKeys]="tagOptions.separatorKeys"
                                                   [autocomplete]="true"
                                                   [onlyFromAutocomplete]="true"
                                                   [autocompleteItems]="availableTags">
                                        </tag-input>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br/>
                        <div class="row top-buffer">
                            <div class="col-md-12">
                                <button *ngIf="canDelete() && icMeetingTopic != null && icMeetingTopic.id != null" type="button" class="btn btn-danger pull-left" (click)="deleteICMeetingTopic()">Delete</button>

                                <button *ngIf="canEdit()" type="submit" class="btn btn-success pull-right" (click)="save()" >Save</button>
                            </div>
                        </div>
                        <div class="row top-buffer">
                            <div class="col-md-12">
                            </div>
                        </div>
                    </fieldset>
                    <br/>
                    <div class="row">
                        <button class="btn btn-success pull-right" (click)="approve()" *ngIf="canApprove()">Approve</button>
                        <button class="btn btn-danger pull-right" (click)="cancelApprove()" *ngIf="canCancelApprove()">Dis-approve</button>
                    </div>

                </form>
            </div>
<!--            <div *ngIf="showUpdateBlock()" class="jumbotron col-md-12" style="padding-top: 5px; padding-bottom: 5px;">-->
<!--                <fieldset [disabled]="!canEditUpdateBlock()"> {{canEditUpdateBlock()}}-->
<!--                    <div class="row">-->
<!--                        <div class="col-md-12 form-group form-horizontal">-->
<!--                            <label class="control-label col-md-1" for="questionNameUpd">Updated Name:</label>-->
<!--                            <div class="col-md-11">-->
<!--                                        <textarea fz-elastic type="text" id="questionNameUpd" class="form-control"-->
<!--                                                  name="questionNameUpd" [(ngModel)]="icMeetingTopic.nameUpd"></textarea>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="row">-->
<!--                        <div class="col-md-12 form-group form-horizontal">-->
<!--                            <label class="control-label col-md-1" for="decisionUpd">Updated Decision:</label>-->
<!--                            <div class="col-md-11">-->
<!--                                        <textarea fz-elastic type="text" id="decisionUpd" class="form-control"-->
<!--                                                  name="decisionUpd" [(ngModel)]="icMeetingTopic.decisionUpd"></textarea>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="row withpadding">-->
<!--                        <div class="jumbotron col-md-7" style="padding-top: 5px; padding-bottom: 5px;">-->
<!--                            <div class="row">-->
<!--                                <span>ADDITIONAL MATERIALS</span>-->
<!--                                <label class="btn btn-primary btn-xs" for="attachmentFileUpd" *ngIf="canEditUpdateBlock()">-->
<!--                                    <input type="file" id="attachmentFileUpd" (change)="onFileChangeMaterialsUpd($event)" name="fileUpd" multiple style="display:none;"/>Upload-->
<!--                                </label>-->
<!--                            </div>-->
<!--                            <div class="row">-->
<!--                                <table style="width: 100%; table-layout: fixed;" >-->
<!--                                    <tr *ngFor="let newFile of uploadMaterialsFilesUpd; let j = index" [attr.data-index]="j">-->
<!--                                        <td>-->
<!--                                            <span class="label label-info ">-->
<!--                                                {{newFile.file.name | slice:0:30 }} &nbsp;-->
<!--                                                {{newFile?.file?.name?.length > 30 ? '...' : ''}}-->
<!--                                            </span> &nbsp;-->
<!--                                            <button class="btn btn-xs"  (click)="deleteUnsavedAttachmentUpd(newFile)">-->
<!--                                                <i class="glyphicon glyphicon-trash"></i>-->
<!--                                            </button>-->
<!--                                        </td>-->
<!--                                        <td>-->
<!--                                            <input class="form-control" [attr.id]="'material_file_upd_' + j" type="text" placeholder="name for protocol..." style="width: 100%"-->
<!--                                                   [(ngModel)]="newFile.name" [ngModelOptions]="{standalone: true}"/>-->
<!--                                        </td>-->
<!--                                    </tr>-->
<!--                                </table>-->
<!--                            </div>-->
<!--                            <br/>-->
<!--                            <div class="row">-->
<!--                                <table style="width: 100%; table-layout: fixed;" >-->
<!--                                    <tr *ngFor="let attachment of icMeetingTopic?.materialsUpd; let j = index" [attr.data-index]="j">-->
<!--                                        <td width="45%">-->
<!--                                            <file-attachment-downloader fileId="{{attachment.file.id}}"-->
<!--                                                                        displayFileName="{{(j + 1) + '. ' + attachment?.file?.fileName | slice:0:40}}-->
<!--                                                                        {{attachment?.file?.fileName?.length > 40 ? '...' : ''}}"-->
<!--                                                                        fileName="{{attachment?.file?.fileName}}"-->
<!--                                                                        fileType="IC_MATRL" showIcon="true">-->
<!--                                            </file-attachment-downloader>-->
<!--                                        </td>-->
<!--                                        <td width="45%">-->
<!--                                            <input class="form-control" type="text" style="width: 100%" [(ngModel)]="attachment.name" [ngModelOptions]="{standalone: true}"/>-->
<!--                                        </td>-->
<!--                                        <td width="10%">&nbsp;-->
<!--                                            <button class="btn btn-xs" (click)="deleteAttachment(attachment.file.id, true)" *ngIf="canEditUpdateBlock()">-->
<!--                                                <i class="glyphicon glyphicon-trash"></i>-->
<!--                                            </button>-->
<!--                                        </td>-->
<!--                                    </tr>-->
<!--                                </table>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="jumbotron col-md-5" style="padding-top: 5px; padding-bottom: 5px;">-->
<!--                            <div class="row">-->
<!--                                <span>Explanatory Note UPD:</span>-->
<!--                                <label class="btn btn-primary btn-xs"  *ngIf="canEditUpdateBlock()" [ngClass]="icMeetingTopic.explanatoryNoteUpd != null && icMeetingTopic.explanatoryNoteUpd.id > 0 ? 'disabled' : ''"  for="explanatoryNoteFileUpd">-->
<!--                                    <input type="file" id="explanatoryNoteFileUpd" (change)="onFileChangeExplanatoryNoteUpd($event)" [disabled]="icMeetingTopic.explanatoryNoteUpd != null && icMeetingTopic.explanatoryNoteUpd.id > 0" name="explanatoryNoteFileUpd" style="display:none;"/>Upload-->
<!--                                </label>-->
<!--                            </div>-->
<!--                            <div class="row">-->
<!--                                <table style="width: 100%; table-layout: fixed;" >-->
<!--                                    <tr *ngFor="let newFile of uploadExplanatoryNoteFileUpd; let j = index" [attr.data-index]="j">-->
<!--                                        <td>-->
<!--                                            <span class="label label-info ">-->
<!--                                                {{newFile.name | slice:0:30 }} &nbsp;-->
<!--                                                {{newFile?.name?.length > 30 ? '...' : ''}}-->
<!--                                            </span>&nbsp;-->
<!--                                            <button class="btn btn-xs"  (click)="deleteUnsavedExplanatoryNoteUpd(newFile)">-->
<!--                                                <i class="glyphicon glyphicon-trash"></i>-->
<!--                                            </button>-->
<!--                                        </td>-->
<!--                                    </tr>-->
<!--                                </table>-->
<!--                            </div>-->
<!--                            <div class="row">-->
<!--                                <br/>-->
<!--                                <table style="width: 100%; table-layout: fixed;" >-->
<!--                                    <tr *ngIf="icMeetingTopic.explanatoryNoteUpd != null">-->
<!--                                        <td width="90%">-->
<!--                                            <file-attachment-downloader fileId="{{icMeetingTopic.explanatoryNoteUpd.id}}"-->
<!--                                                                        displayFileName="{{icMeetingTopic.explanatoryNoteUpd.fileName | slice:0:40}}-->
<!--                                                                    {{icMeetingTopic.explanatoryNoteUpd.fileName?.length > 40 ? '...' : ''}}"-->
<!--                                                                        fileName="{{icMeetingTopic.explanatoryNoteUpd.fileName}}"-->
<!--                                                                        fileType="IC_EXPNOTE" showIcon="true">-->
<!--                                            </file-attachment-downloader>-->
<!--                                        </td>-->
<!--                                        <td width="10%">&nbsp;-->
<!--                                            <button class="btn btn-xs" (click)="deleteExplanatoryNoteUpd()" *ngIf="icMeetingTopic.explanatoryNoteUpd.id > 0 && canEditUpdateBlock()">-->
<!--                                                <i class="glyphicon glyphicon-trash"></i>-->
<!--                                            </button>-->
<!--                                        </td>-->
<!--                                    </tr>-->
<!--                                </table>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="row">-->
<!--                        <label class="checkbox pull-right">-->
<!--                            <input type="checkbox" [checked]="icMeetingTopic.publishedUpd" id="publishedUpdCheckbox">update is final-->
<!--                        </label>-->
<!--                    </div>-->
<!--                    <div class="row top-buffer">-->
<!--                        <div class="col-md-12">-->
<!--                            <button  *ngIf="canEditUpdateBlock()" type="button" class="btn btn-success pull-right" (click)="saveUpd()" >Save Update</button>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </fieldset>-->
<!--            </div>-->
        </div>
    </div>
    <br>
    <br>
    <br>
</div>

